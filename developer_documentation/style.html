<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Style &mdash; SPECFEM KOKKOS IMPLEMENTATION  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/scrollable_code_blocks.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API documentation" href="../api/index.html" />
    <link rel="prev" title="Build system requirements" href="build_requirements.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SPECFEM KOKKOS IMPLEMENTATION
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user_documentation/index.html">User documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameter_documentation/index.html">Parameter documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source_description/index.html">Source Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cookbooks/index.html">Cookbooks</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="git_workflow.html">Git development workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_requirements.html">Build system requirements</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Style</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pre-commit">Pre-commit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#poetry-installation">Poetry Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-python-packages">Adding python packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-python-packages">Install python packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-your-python-poetry-environment">Using your python/poetry environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pre-commit-hooks">Pre-commit hooks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SPECFEM KOKKOS IMPLEMENTATION</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Developer documentation</a></li>
      <li class="breadcrumb-item active">Style</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/developer_documentation/style.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="style">
<h1>Style<a class="headerlink" href="#style" title="Link to this heading"></a></h1>
</section>
<section id="pre-commit">
<h1>Pre-commit<a class="headerlink" href="#pre-commit" title="Link to this heading"></a></h1>
<p>SPECFEM uses pre-commit to check style. Pre-commit can be installed inside python virtual environments. There are several methods for creating virtual environments, but I’ve found poetry tool is great at managing python environments. Especailly in collaborative environments poetry gives easy method for managing consistency of environments between all contributors via <code class="code docutils literal notranslate"><span class="pre">pyproject.toml</span></code> and <code class="code docutils literal notranslate"><span class="pre">poetry.lock</span></code> files. But more on this later.</p>
<p>Here we give a short tutorial for using poetry specifically with intention of using pre-commit hooks, but the information provided here can be translated for managing any python environment. The official poetry documentation can be found at <a class="reference external" href="https://python-poetry.org/docs/">poetry docs</a></p>
<section id="poetry-installation">
<h2>Poetry Installation<a class="headerlink" href="#poetry-installation" title="Link to this heading"></a></h2>
<p>Make sure your python version is 3.7+ :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>--version
</pre></div>
</div>
<p>Download and install poetry:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-sSL<span class="w"> </span>https://install.python-poetry.org<span class="w"> </span><span class="p">|</span><span class="w"> </span>python3<span class="w"> </span>-<span class="w"> </span>--version<span class="w"> </span><span class="m">1</span>.1.13
</pre></div>
</div>
<p>You can check if installation succeeded using</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>--version
</pre></div>
</div>
</section>
<section id="adding-python-packages">
<h2>Adding python packages<a class="headerlink" href="#adding-python-packages" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is only for educational purposes since SPECFEM comes with a <code class="code docutils literal notranslate"><span class="pre">pyproject.toml</span></code></p>
</div>
<p>We define all the packages required within our environment using the <cite>pyproject.toml</cite> file. For example, if we needed to add pre-commit to our environment we would define it within <code class="code docutils literal notranslate"><span class="pre">pyproject.toml</span></code> as</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.poetry]</span>
<span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;specfem2d_kokkos&quot;</span>
<span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0.1.0&quot;</span>
<span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Kokkos implementation of SpecFEM2D code&quot;</span>
<span class="n">authors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;Your Name &lt;you@example.com&gt;&quot;</span><span class="p">]</span>

<span class="k">[tool.poetry.dependencies]</span>
<span class="n">python</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&gt;=3.7,&lt;4.0&quot;</span>
<span class="n">pre-commit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;^=2.19.0&quot;</span>

<span class="k">[tool.poetry.dev-dependencies]</span>

<span class="k">[build-system]</span>
<span class="n">requires</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;poetry-core&gt;=1.0.0&quot;</span><span class="p">]</span>
<span class="n">build-backend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;poetry.core.masonry.api&quot;</span>
</pre></div>
</div>
<p>As stated above we define our python, and pre-commit versions within <code class="code docutils literal notranslate"><span class="pre">pyproject.toml</span></code>.</p>
</section>
<section id="install-python-packages">
<h2>Install python packages<a class="headerlink" href="#install-python-packages" title="Link to this heading"></a></h2>
<p>To install python packages run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>install
</pre></div>
</div>
<p>When you run this command one of two things happen,</p>
<ol class="arabic simple">
<li><p>If a correct version of a package already exists within <code class="code docutils literal notranslate"><span class="pre">poetry.lock</span></code> file then poetry installs that version. Here the assumption is that a <cite>poetry.lock</cite> already exists, if not then one is created for you (within SPECFEM <cite>poetry.lock</cite> should already exist). <cite>poetry.lock</cite> ensures that all developers have consistent environments.</p></li>
<li><p>If a correct version of a package doesn’t exist within <code class="code docutils literal notranslate"><span class="pre">poetry.lock</span></code> then poetry will install a correct version and update <cite>poetry.lock</cite> file.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure you commit <code class="code docutils literal notranslate"><span class="pre">poetry.lock</span></code> and <code class="code docutils literal notranslate"><span class="pre">pyproject.toml</span></code> files upstream to the remote if you add any packages.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is also recommended that you run <code class="code docutils literal notranslate"><span class="pre">poetry</span> <span class="pre">install</span></code> every time you pull the develop branch</p>
</div>
</section>
<section id="using-your-python-poetry-environment">
<h2>Using your python/poetry environment<a class="headerlink" href="#using-your-python-poetry-environment" title="Link to this heading"></a></h2>
<p>If you’re in the SPECFEM root directory you should have access to the poetry environment. To run a command within the environment either</p>
<ol class="arabic simple">
<li><p>Explicitly activate the environment using <code class="code docutils literal notranslate"><span class="pre">poetry</span> <span class="pre">shell</span></code> as shown below</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>shell
python<span class="w"> </span>&lt;script_name&gt;.py
</pre></div>
</div>
<p>Or</p>
<ol class="arabic simple" start="2">
<li><p>Directly run the command within environment using <code class="code docutils literal notranslate"><span class="pre">poetry</span> <span class="pre">run</span></code></p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>python<span class="w"> </span>&lt;script_name&gt;.py
</pre></div>
</div>
</section>
<section id="pre-commit-hooks">
<h2>Pre-commit hooks<a class="headerlink" href="#pre-commit-hooks" title="Link to this heading"></a></h2>
<p>Next, we install pre-commit hooks to check style. Pre-commit hooks are defined in <code class="code docutils literal notranslate"><span class="pre">.pre-commit-config.yaml</span></code> within SPECFEM root directory. More documentation on pre-commit hooks can be found <a class="reference external" href="https://pre-commit.com/hooks.html">here</a>.</p>
<p>To enable the hooks (This only needs to be done when you clone the repo or there is an update to <code class="code docutils literal notranslate"><span class="pre">.pre-commit-config.yaml</span></code>)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>pre-commit<span class="w"> </span>install
</pre></div>
</div>
<p>After this, pre-commit should run every time you commit a change. Ensuring that coding style is consistent across all developers.</p>
<p>To manually run pre-commit on all files</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>poetry<span class="w"> </span>run<span class="w"> </span>pre-commit<span class="w"> </span>run<span class="w"> </span>--all-files
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="build_requirements.html" class="btn btn-neutral float-left" title="Build system requirements" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../api/index.html" class="btn btn-neutral float-right" title="API documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Rohit Kakodkar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>