<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wave propagration through homogeneous media &mdash; SPECFEM KOKKOS IMPLEMENTATION  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/scrollable_code_blocks.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Developer documentation" href="../developer_documentation/index.html" />
    <link rel="prev" title="Cookbooks" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SPECFEM KOKKOS IMPLEMENTATION
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user_documentation/index.html">User documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameter_documentation/index.html">Parameter documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source_description/index.html">Source Description</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Cookbooks</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Wave propagration through homogeneous media</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generating-a-mesh">Generating a mesh</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parameter-file">Parameter File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#topography-file">Topography file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-xmeshfem2d">Running <code class="docutils literal notranslate"><span class="pre">xmeshfem2D</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#defining-sources">Defining sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-the-solver">Configuring the solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-solver">Running the solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualizing-seimograms">Visualizing seimograms</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer_documentation/index.html">Developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SPECFEM KOKKOS IMPLEMENTATION</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Cookbooks</a></li>
      <li class="breadcrumb-item active">Wave propagration through homogeneous media</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/cookbooks/example_01.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="wave-propagration-through-homogeneous-media">
<h1>Wave propagration through homogeneous media<a class="headerlink" href="#wave-propagration-through-homogeneous-media" title="Link to this heading"></a></h1>
<p>In this example we simulate wave propagation through a 2-dimensional homogeneous medium.</p>
<section id="generating-a-mesh">
<h2>Generating a mesh<a class="headerlink" href="#generating-a-mesh" title="Link to this heading"></a></h2>
<p>To generate a mesh for homogeneous media we utilize <a class="reference external" href="https://specfem2d.readthedocs.io/en/latest/03_mesh_generation/">SPECFEM2D mesh generator</a> (xmeshfem2d). To run xmeshfem2d we need to define 2
files: The <code class="docutils literal notranslate"><span class="pre">Par_file</span></code>, which defines the parameters used by <code class="docutils literal notranslate"><span class="pre">xmeshfem2D</span></code>, and <code class="docutils literal notranslate"><span class="pre">topography_file.dat</span></code>, which defines
the topography of the domain. More information on generating the mesh can be found <a class="reference external" href="https://specfem2d.readthedocs.io/en/latest/03_mesh_generation/">here</a>.</p>
<section id="parameter-file">
<h3>Parameter File<a class="headerlink" href="#parameter-file" title="Link to this heading"></a></h3>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">PAR_FILE</span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#-----------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Simulation input parameters</span>
<span class="c1">#</span>
<span class="c1">#-----------------------------------------------------------</span>

<span class="c1"># title of job</span>
<span class="nv">title</span><span class="w">                           </span><span class="o">=</span><span class="w"> </span>Elastic<span class="w"> </span>Simulation<span class="w"> </span>with<span class="w"> </span>point<span class="w"> </span><span class="nb">source</span>

<span class="c1"># forward or adjoint simulation</span>
<span class="c1"># 1 = forward, 2 = adjoint, 3 = both simultaneously</span>
<span class="c1"># note: 2 is purposely UNUSED (for compatibility with the numbering of our 3D codes)</span>
<span class="nv">SIMULATION_TYPE</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="c1"># 0 = regular wave propagation simulation, 1/2/3 = noise simulation</span>
<span class="nv">NOISE_TOMOGRAPHY</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="c1"># save the last frame, needed for adjoint simulation</span>
<span class="nv">SAVE_FORWARD</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span>.false.

<span class="c1"># parameters concerning partitioning</span>
<span class="nv">NPROC</span><span class="w">                           </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w">              </span><span class="c1"># number of processes</span>

<span class="c1"># time step parameters</span>
<span class="c1"># total number of time steps</span>
<span class="nv">NSTEP</span><span class="w">                           </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>

<span class="c1"># duration of a time step (see section &quot;How to choose the time step&quot; of the manual for how to do this)</span>
<span class="nv">DT</span><span class="w">                              </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>.1d-5

<span class="c1"># time stepping</span>
<span class="c1"># 1 = Newmark (2nd order), 2 = LDDRK4-6 (4th-order 6-stage low storage Runge-Kutta), 3 = classical RK4 4th-order 4-stage Runge-Kutta</span>
<span class="nv">time_stepping_scheme</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>

<span class="c1"># set the type of calculation (P-SV or SH/membrane waves)</span>
<span class="nv">P_SV</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span>.true.

<span class="c1"># axisymmetric (2.5D) or Cartesian planar (2D) simulation</span>
<span class="nv">AXISYM</span><span class="w">                          </span><span class="o">=</span><span class="w"> </span>.false.

<span class="c1">#-----------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Mesh</span>
<span class="c1">#</span>
<span class="c1">#-----------------------------------------------------------</span>

<span class="c1"># Partitioning algorithm for decompose_mesh</span>
<span class="nv">PARTITIONING_TYPE</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w">              </span><span class="c1"># SCOTCH = 3, ascending order (very bad idea) = 1</span>

<span class="c1"># number of control nodes per element (4 or 9)</span>
<span class="nv">NGNOD</span><span class="w">                           </span><span class="o">=</span><span class="w"> </span><span class="m">9</span>

<span class="c1"># creates/reads a binary database that allows to skip all time consuming setup steps in initialization</span>
<span class="c1"># 0 = does not read/create database</span>
<span class="c1"># 1 = creates database</span>
<span class="c1"># 2 = reads database</span>
<span class="nv">setup_with_binary_database</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>

<span class="c1"># available models</span>
<span class="c1">#   default       - define model using nbmodels below</span>
<span class="c1">#   ascii         - read model from ascii database file</span>
<span class="c1">#   binary        - read model from binary databse file</span>
<span class="c1">#   binary_voigt  - read Voigt model from binary database file</span>
<span class="c1">#   external      - define model using define_external_model subroutine</span>
<span class="c1">#   gll           - read GLL model from binary database file</span>
<span class="c1">#   legacy        - read model from model_velocity.dat_input</span>
<span class="nv">MODEL</span><span class="w">                           </span><span class="o">=</span><span class="w"> </span>default

<span class="c1"># Output the model with the requested type, does not save if turn to default or .false.</span>
<span class="c1"># (available output formats: ascii,binary,gll,legacy)</span>
<span class="nv">SAVE_MODEL</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span>default


<span class="c1">#-----------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Attenuation</span>
<span class="c1">#</span>
<span class="c1">#-----------------------------------------------------------</span>

<span class="c1"># attenuation parameters</span>
<span class="nv">ATTENUATION_VISCOELASTIC</span><span class="w">        </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># turn attenuation (viscoelasticity) on or off for non-poroelastic solid parts of the model</span>
<span class="nv">ATTENUATION_VISCOACOUSTIC</span><span class="w">       </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># turn attenuation (viscoacousticity) on or off for non-poroelastic fluid parts of the model</span>

<span class="c1"># for viscoelastic or viscoacoustic attenuation</span>
<span class="nv">N_SLS</span><span class="w">                           </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w">              </span><span class="c1"># number of standard linear solids for attenuation (3 is usually the minimum)</span>
<span class="nv">ATTENUATION_f0_REFERENCE</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>.196<span class="w">          </span><span class="c1"># in case of attenuation, reference frequency in Hz at which the velocity values in the velocity model are given (unused otherwise); relevant only if source is a Dirac or a Heaviside, otherwise it is automatically set to f0 the dominant frequency of the source in the DATA/SOURCE file</span>
<span class="nv">READ_VELOCITIES_AT_f0</span><span class="w">           </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># read seismic velocities at ATTENUATION_f0_REFERENCE instead of at infinite frequency (see user manual for more information)</span>
<span class="nv">USE_SOLVOPT</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># use more precise but much more expensive way of determining the Q factor relaxation times, as in https://doi.org/10.1093/gji/ggw024</span>

<span class="c1"># for poroelastic attenuation</span>
<span class="nv">ATTENUATION_PORO_FLUID_PART</span><span class="w">     </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># turn viscous attenuation on or off for the fluid part of poroelastic parts of the model</span>
<span class="nv">Q0_poroelastic</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w">              </span><span class="c1"># quality factor for viscous attenuation (ignore it if you are not using a poroelastic material)</span>
<span class="nv">freq0_poroelastic</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="w">             </span><span class="c1"># frequency for viscous attenuation (ignore it if you are not using a poroelastic material)</span>

<span class="c1"># to undo attenuation and/or PMLs for sensitivity kernel calculations or forward runs with SAVE_FORWARD</span>
<span class="c1"># use the flag below. It performs undoing of attenuation and/or of PMLs in an exact way for sensitivity kernel calculations</span>
<span class="c1"># but requires disk space for temporary storage, and uses a significant amount of memory used as buffers for temporary storage.</span>
<span class="c1"># When that option is on the second parameter indicates how often the code dumps restart files to disk (if in doubt, use something between 100 and 1000).</span>
<span class="nv">UNDO_ATTENUATION_AND_OR_PML</span><span class="w">     </span><span class="o">=</span><span class="w"> </span>.false.
<span class="nv">NT_DUMP_ATTENUATION</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="m">500</span>

<span class="c1"># Instead of reconstructing the forward wavefield, this option reads it from the disk using asynchronous I/O.</span>
<span class="c1"># Outperforms conventional mode using a value of NTSTEP_BETWEEN_COMPUTE_KERNELS high enough.</span>
<span class="nv">NO_BACKWARD_RECONSTRUCTION</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>.false.

<span class="c1">#-----------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Sources</span>
<span class="c1">#</span>
<span class="c1">#-----------------------------------------------------------</span>

<span class="c1"># source parameters</span>
<span class="nv">NSOURCES</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w">              </span><span class="c1"># number of sources (source information is then read from the DATA/SOURCE file)</span>
<span class="nv">force_normal_to_surface</span><span class="w">         </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># angleforce normal to surface (external mesh and curve file needed)</span>

<span class="c1"># use an existing initial wave field as source or start from zero (medium initially at rest)</span>
<span class="nv">initialfield</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span>.false.
<span class="nv">add_Bielak_conditions_bottom</span><span class="w">    </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># add Bielak conditions or not if initial plane wave</span>
<span class="nv">add_Bielak_conditions_right</span><span class="w">     </span><span class="o">=</span><span class="w"> </span>.false.
<span class="nv">add_Bielak_conditions_top</span><span class="w">       </span><span class="o">=</span><span class="w"> </span>.false.
<span class="nv">add_Bielak_conditions_left</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>.false.

<span class="c1"># acoustic forcing</span>
<span class="nv">ACOUSTIC_FORCING</span><span class="w">                </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># acoustic forcing of an acoustic medium with a rigid interface</span>

<span class="c1"># noise simulations - type of noise source time function:</span>
<span class="c1"># 0=external (S_squared), 1=Ricker(second derivative), 2=Ricker(first derivative), 3=Gaussian, 4=Figure 2a of Tromp et al. 2010</span>
<span class="c1"># (default value 4 is chosen to reproduce the time function from Fig 2a of &quot;Tromp et al., 2010, Noise Cross-Correlation Sensitivity Kernels&quot;)</span>
<span class="nv">noise_source_time_function_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span>

<span class="c1"># moving sources</span>
<span class="c1"># Set write_moving_sources_database to .true. if the generation of moving source databases takes</span>
<span class="c1"># a long time. Then the simulation is done in two steps: first you run the code and it writes the databases to file</span>
<span class="c1"># (in DATA folder by default). Then you rerun the code and it will read the databases in there directly possibly</span>
<span class="c1"># saving a lot of time.</span>
<span class="c1"># This is only useful for GPU version (for now)</span>
<span class="nv">write_moving_sources_database</span><span class="w">   </span><span class="o">=</span><span class="w"> </span>.false.

<span class="c1">#-----------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Receivers</span>
<span class="c1">#</span>
<span class="c1">#-----------------------------------------------------------</span>

<span class="c1"># receiver set parameters for recording stations (i.e. recording points)</span>
<span class="c1"># seismotype : record 1=displ 2=veloc 3=accel 4=pressure 5=curl of displ 6=the fluid potential</span>
<span class="nv">seismotype</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w">              </span><span class="c1"># several values can be chosen. For example : 1,2,4</span>

<span class="c1"># interval in time steps for writing of seismograms</span>
<span class="c1"># every how many time steps we save the seismograms</span>
<span class="c1"># (costly, do not use a very small value; if you use a very large value that is larger than the total number</span>
<span class="c1">#  of time steps of the run, the seismograms will automatically be saved once at the end of the run anyway)</span>
<span class="nv">NTSTEP_BETWEEN_OUTPUT_SEISMOS</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">10000</span>

<span class="c1"># set to n to reduce the sampling rate of output seismograms by a factor of n</span>
<span class="c1"># defaults to 1, which means no down-sampling</span>
<span class="nv">NTSTEP_BETWEEN_OUTPUT_SAMPLE</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>

<span class="c1"># so far, this option can only be used if all the receivers are in acoustic elements</span>
<span class="nv">USE_TRICK_FOR_BETTER_PRESSURE</span><span class="w">   </span><span class="o">=</span><span class="w"> </span>.false.

<span class="c1"># use this t0 as earliest starting time rather than the automatically calculated one</span>
<span class="nv">USER_T0</span><span class="w">                         </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0d0

<span class="c1"># seismogram formats</span>
<span class="nv">save_ASCII_seismograms</span><span class="w">          </span><span class="o">=</span><span class="w"> </span>.true.<span class="w">         </span><span class="c1"># save seismograms in ASCII format or not</span>
<span class="nv">save_binary_seismograms_single</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>.true.<span class="w">         </span><span class="c1"># save seismograms in single precision binary format or not (can be used jointly with ASCII above to save both)</span>
<span class="nv">save_binary_seismograms_double</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># save seismograms in double precision binary format or not (can be used jointly with both flags above to save all)</span>
<span class="nv">SU_FORMAT</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># output single precision binary seismograms in Seismic Unix format (adjoint traces will be read in the same format)</span>

<span class="c1"># use an existing STATION file found in ./DATA or create a new one from the receiver positions below in this Par_file</span>
<span class="nv">use_existing_STATIONS</span><span class="w">           </span><span class="o">=</span><span class="w"> </span>.false.

<span class="c1"># number of receiver sets (i.e. number of receiver lines to create below)</span>
<span class="nv">nreceiversets</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>

<span class="c1"># orientation</span>
<span class="nv">anglerec</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.d0<span class="w">           </span><span class="c1"># angle to rotate components at receivers</span>
<span class="nv">rec_normal_to_surface</span><span class="w">           </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># base anglerec normal to surface (external mesh and curve file needed)</span>

<span class="c1"># first receiver set (repeat these 6 lines and adjust nreceiversets accordingly)</span>
<span class="nv">nrec</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="w">             </span><span class="c1"># number of receivers</span>
<span class="nv">xdeb</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>.<span class="w">           </span><span class="c1"># first receiver x in meters</span>
<span class="nv">zdeb</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="m">2200</span>.<span class="w">          </span><span class="c1"># first receiver z in meters</span>
<span class="nv">xfin</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="m">3700</span>.<span class="w">          </span><span class="c1"># last receiver x in meters (ignored if only one receiver)</span>
<span class="nv">zfin</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="m">2200</span>.<span class="w">          </span><span class="c1"># last receiver z in meters (ignored if only one receiver)</span>
<span class="nv">record_at_surface_same_vertical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>.true.<span class="w">         </span><span class="c1"># receivers inside the medium or at the surface (z values are ignored if this is set to true, they are replaced with the topography height)</span>

<span class="c1"># second receiver set</span>
<span class="nv">nrec</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="w">             </span><span class="c1"># number of receivers</span>
<span class="nv">xdeb</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="m">2500</span>.<span class="w">          </span><span class="c1"># first receiver x in meters</span>
<span class="nv">zdeb</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="m">2500</span>.<span class="w">          </span><span class="c1"># first receiver z in meters</span>
<span class="nv">xfin</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="m">2500</span>.<span class="w">          </span><span class="c1"># last receiver x in meters (ignored if only one receiver)</span>
<span class="nv">zfin</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.<span class="w">             </span><span class="c1"># last receiver z in meters (ignored if only one receiver)</span>
<span class="nv">record_at_surface_same_vertical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># receivers inside the medium or at the surface (z values are ignored if this is set to true, they are replaced with the topography height)</span>


<span class="c1">#-----------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># adjoint kernel outputs</span>
<span class="c1">#</span>
<span class="c1">#-----------------------------------------------------------</span>

<span class="c1"># save sensitivity kernels in ASCII format (much bigger files, but compatible with current GMT scripts) or in binary format</span>
<span class="nv">save_ASCII_kernels</span><span class="w">              </span><span class="o">=</span><span class="w"> </span>.true.

<span class="c1"># since the accuracy of kernel integration may not need to respect the CFL, this option permits to save computing time, and memory with UNDO_ATTENUATION_AND_OR_PML mode</span>
<span class="nv">NTSTEP_BETWEEN_COMPUTE_KERNELS</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>

<span class="c1"># outputs approximate Hessian for preconditioning</span>
<span class="nv">APPROXIMATE_HESS_KL</span><span class="w">             </span><span class="o">=</span><span class="w"> </span>.false.

<span class="c1">#-----------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Boundary conditions</span>
<span class="c1">#</span>
<span class="c1">#-----------------------------------------------------------</span>

<span class="c1"># Perfectly Matched Layer (PML) boundaries</span>
<span class="c1"># absorbing boundary active or not</span>
<span class="nv">PML_BOUNDARY_CONDITIONS</span><span class="w">         </span><span class="o">=</span><span class="w"> </span>.false.
<span class="nv">NELEM_PML_THICKNESS</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>
<span class="nv">ROTATE_PML_ACTIVATE</span><span class="w">             </span><span class="o">=</span><span class="w"> </span>.false.
<span class="nv">ROTATE_PML_ANGLE</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>.
<span class="c1"># change the four parameters below only if you know what you are doing; they change the damping profiles inside the PMLs</span>
<span class="nv">K_MIN_PML</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>.0d0<span class="w">          </span><span class="c1"># from Gedney page 8.11</span>
<span class="nv">K_MAX_PML</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>.0d0
<span class="nv">damping_change_factor_acoustic</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.5d0
<span class="nv">damping_change_factor_elastic</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>.0d0
<span class="c1"># set the parameter below to .false. unless you know what you are doing; this implements automatic adjustment of the PML parameters for elongated models.</span>
<span class="c1"># The goal is to improve the absorbing efficiency of PML for waves with large incidence angles, but this can lead to artefacts.</span>
<span class="c1"># In particular, this option is efficient only when the number of sources NSOURCES is equal to one.</span>
<span class="nv">PML_PARAMETER_ADJUSTMENT</span><span class="w">        </span><span class="o">=</span><span class="w"> </span>.false.

<span class="c1"># Stacey ABC</span>
<span class="nv">STACEY_ABSORBING_CONDITIONS</span><span class="w">     </span><span class="o">=</span><span class="w"> </span>.false.

<span class="c1"># periodic boundaries</span>
<span class="nv">ADD_PERIODIC_CONDITIONS</span><span class="w">         </span><span class="o">=</span><span class="w"> </span>.false.
<span class="nv">PERIODIC_HORIZ_DIST</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="m">4000</span>.d0

<span class="c1">#-----------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Velocity and density models</span>
<span class="c1">#</span>
<span class="c1">#-----------------------------------------------------------</span>

<span class="c1"># number of model materials</span>
<span class="nv">nbmodels</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="c1"># available material types (see user manual for more information)</span>
<span class="c1">#   acoustic:              model_number 1 rho Vp 0  0 0 QKappa 9999 0 0 0 0 0 0 (for QKappa use 9999 to ignore it)</span>
<span class="c1">#   elastic:               model_number 1 rho Vp Vs 0 0 QKappa Qmu  0 0 0 0 0 0 (for QKappa and Qmu use 9999 to ignore them)</span>
<span class="c1">#   anisotropic:           model_number 2 rho c11 c13 c15 c33 c35 c55 c12 c23 c25   0 QKappa Qmu</span>
<span class="c1">#   anisotropic in AXISYM: model_number 2 rho c11 c13 c15 c33 c35 c55 c12 c23 c25 c22 QKappa Qmu</span>
<span class="c1">#   poroelastic:           model_number 3 rhos rhof phi c kxx kxz kzz Ks Kf Kfr etaf mufr Qmu</span>
<span class="c1">#   tomo:                  model_number -1 0 0 A 0 0 0 0 0 0 0 0 0 0</span>
<span class="c1">#</span>
<span class="c1"># note: When viscoelasticity or viscoacousticity is turned on,</span>
<span class="c1">#       the Vp and Vs values that are read here are the UNRELAXED ones i.e. the values at infinite frequency</span>
<span class="c1">#       unless the READ_VELOCITIES_AT_f0 parameter above is set to true, in which case they are the values at frequency f0.</span>
<span class="c1">#</span>
<span class="c1">#       Please also note that Qmu is always equal to Qs, but Qkappa is in general not equal to Qp.</span>
<span class="c1">#       To convert one to the other see doc/Qkappa_Qmu_versus_Qp_Qs_relationship_in_2D_plane_strain.pdf and</span>
<span class="c1">#       utils/attenuation/conversion_from_Qkappa_Qmu_to_Qp_Qs_from_Dahlen_Tromp_959_960.f90.</span>
<span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2700</span>.d0<span class="w"> </span><span class="m">3000</span>.d0<span class="w"> </span><span class="m">1732</span>.051d0<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">9999</span><span class="w"> </span><span class="m">9999</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
<span class="c1"># 2 1 2500.d0 2700.d0 1443.375d0 0 0 9999 9999 0 0 0 0 0 0</span>
<span class="c1"># 3 1 2200.d0 2500.d0 1443.375d0 0 0 9999 9999 0 0 0 0 0 0</span>
<span class="c1"># 4 1 2200.d0 2200.d0 1343.375d0 0 0 9999 9999 0 0 0 0 0 0</span>

<span class="c1"># external tomography file</span>
<span class="nv">TOMOGRAPHY_FILE</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span>./DATA/tomo_file.xyz

<span class="c1"># use an external mesh created by an external meshing tool or use the internal mesher</span>
<span class="nv">read_external_mesh</span><span class="w">              </span><span class="o">=</span><span class="w"> </span>.false.

<span class="c1">#-----------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># PARAMETERS FOR EXTERNAL MESHING</span>
<span class="c1">#</span>
<span class="c1">#-----------------------------------------------------------</span>

<span class="c1"># data concerning mesh, when generated using third-party app (more info in README)</span>
<span class="c1"># (see also absorbing_conditions above)</span>
<span class="nv">mesh_file</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span>./DATA/mesh_file<span class="w">          </span><span class="c1"># file containing the mesh</span>
<span class="nv">nodes_coords_file</span><span class="w">               </span><span class="o">=</span><span class="w"> </span>./DATA/nodes_coords_file<span class="w">  </span><span class="c1"># file containing the nodes coordinates</span>
<span class="nv">materials_file</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span>./DATA/materials_file<span class="w">     </span><span class="c1"># file containing the material number for each element</span>
<span class="nv">free_surface_file</span><span class="w">               </span><span class="o">=</span><span class="w"> </span>./DATA/free_surface_file<span class="w">  </span><span class="c1"># file containing the free surface</span>
<span class="nv">axial_elements_file</span><span class="w">             </span><span class="o">=</span><span class="w"> </span>./DATA/axial_elements_file<span class="w">   </span><span class="c1"># file containing the axial elements if AXISYM is true</span>
<span class="nv">absorbing_surface_file</span><span class="w">          </span><span class="o">=</span><span class="w"> </span>./DATA/absorbing_surface_file<span class="w">   </span><span class="c1"># file containing the absorbing surface</span>
<span class="nv">acoustic_forcing_surface_file</span><span class="w">   </span><span class="o">=</span><span class="w"> </span>./DATA/MSH/Surf_acforcing_Bottom_enforcing_mesh<span class="w">   </span><span class="c1"># file containing the acoustic forcing surface</span>
<span class="nv">absorbing_cpml_file</span><span class="w">             </span><span class="o">=</span><span class="w"> </span>./DATA/absorbing_cpml_file<span class="w">   </span><span class="c1"># file containing the CPML element numbers</span>
<span class="nv">tangential_detection_curve_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>./DATA/courbe_eros_nodes<span class="w">  </span><span class="c1"># file containing the curve delimiting the velocity model</span>

<span class="c1">#-----------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># PARAMETERS FOR INTERNAL MESHING</span>
<span class="c1">#</span>
<span class="c1">#-----------------------------------------------------------</span>

<span class="c1"># file containing interfaces for internal mesh</span>
<span class="nv">interfacesfile</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span>../EXAMPLES/simple_topography_and_also_a_simple_fluid_layer/DATA/interfaces_simple_topo_flat.dat

<span class="c1"># geometry of the model (origin lower-left corner = 0,0) and mesh description</span>
<span class="nv">xmin</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.d0<span class="w">           </span><span class="c1"># abscissa of left side of the model</span>
<span class="nv">xmax</span><span class="w">                            </span><span class="o">=</span><span class="w"> </span><span class="m">4000</span>.d0<span class="w">        </span><span class="c1"># abscissa of right side of the model</span>
<span class="nv">nx</span><span class="w">                              </span><span class="o">=</span><span class="w"> </span><span class="m">80</span><span class="w">             </span><span class="c1"># number of elements along X</span>

<span class="c1"># absorbing boundary parameters (see absorbing_conditions above)</span>
<span class="nv">absorbbottom</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span>.false.
<span class="nv">absorbright</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span>.false.
<span class="nv">absorbtop</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span>.false.
<span class="nv">absorbleft</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span>.false.

<span class="c1"># define the different regions of the model in the (nx,nz) spectral-element mesh</span>
<span class="nv">nbregions</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w">              </span><span class="c1"># then set below the different regions and model number for each region</span>
<span class="c1"># format of each line: nxmin nxmax nzmin nzmax material_number</span>
<span class="m">1</span><span class="w"> </span><span class="m">80</span><span class="w">  </span><span class="m">1</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="m">1</span>
<span class="c1"># 1 59 21 40 2</span>
<span class="c1"># 71 80 21 40 2</span>
<span class="c1"># 1 80 41 60 3</span>
<span class="c1"># 60 70 21 40 4</span>

<span class="c1">#-----------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Display parameters</span>
<span class="c1">#</span>
<span class="c1">#-----------------------------------------------------------</span>

<span class="c1"># interval at which we output time step info and max of norm of displacement</span>
<span class="c1"># (every how many time steps we display information about the simulation. costly, do not use a very small value)</span>
<span class="nv">NTSTEP_BETWEEN_OUTPUT_INFO</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>

<span class="c1"># meshing output</span>
<span class="nv">output_grid_Gnuplot</span><span class="w">             </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># generate a GNUPLOT file containing the grid, and a script to plot it</span>
<span class="nv">output_grid_ASCII</span><span class="w">               </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># dump the grid in an ASCII text file consisting of a set of X,Y,Z points or not</span>

<span class="c1"># to plot total energy curves, for instance to monitor how CPML absorbing layers behave;</span>
<span class="c1"># should be turned OFF in most cases because a bit expensive</span>
<span class="nv">OUTPUT_ENERGY</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span>.false.

<span class="c1"># every how many time steps we compute energy (which is a bit expensive to compute)</span>
<span class="nv">NTSTEP_BETWEEN_OUTPUT_ENERGY</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>

<span class="c1"># Compute the field int_0^t v^2 dt for a set of GLL points and write it to file. Use</span>
<span class="c1"># the script utils/visualisation/plotIntegratedEnergyFile.py to watch. It is refreshed at the same time than the seismograms</span>
<span class="nv">COMPUTE_INTEGRATED_ENERGY_FIELD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>.false.

<span class="c1">#-----------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Movies/images/snaphots visualizations</span>
<span class="c1">#</span>
<span class="c1">#-----------------------------------------------------------</span>

<span class="c1"># every how many time steps we draw JPEG or PostScript pictures of the simulation</span>
<span class="c1"># and/or we dump results of the simulation as ASCII or binary files (costly, do not use a very small value)</span>
<span class="nv">NTSTEP_BETWEEN_OUTPUT_IMAGES</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>

<span class="c1"># minimum amplitude kept in % for the JPEG and PostScript snapshots; amplitudes below that are muted</span>
<span class="nv">cutsnaps</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>.

<span class="c1">#### for JPEG color images ####</span>
<span class="nv">output_color_image</span><span class="w">              </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">         </span><span class="c1"># output JPEG color image of the results every NTSTEP_BETWEEN_OUTPUT_IMAGES time steps or not</span>
<span class="nv">imagetype_JPEG</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="w">              </span><span class="c1"># display 1=displ_Ux 2=displ_Uz 3=displ_norm 4=veloc_Vx 5=veloc_Vz 6=veloc_norm 7=accel_Ax 8=accel_Az 9=accel_norm 10=pressure</span>
<span class="nv">factor_subsample_image</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>.0d0<span class="w">          </span><span class="c1"># (double precision) factor to subsample or oversample (if set to e.g. 0.5) color images output by the code (useful for very large models, or to get nicer looking denser pictures)</span>
<span class="nv">USE_CONSTANT_MAX_AMPLITUDE</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>.true.<span class="w">        </span><span class="c1"># by default the code normalizes each image independently to its maximum; use this option to use the global maximum below instead</span>
<span class="nv">CONSTANT_MAX_AMPLITUDE_TO_USE</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>.17d-7<span class="w">         </span><span class="c1"># constant maximum amplitude to use for all color images if the above USE_CONSTANT_MAX_AMPLITUDE option is true</span>
<span class="nv">POWER_DISPLAY_COLOR</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.30d0<span class="w">         </span><span class="c1"># non linear display to enhance small amplitudes in JPEG color images</span>
<span class="nv">DRAW_SOURCES_AND_RECEIVERS</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>.true.<span class="w">         </span><span class="c1"># display sources as orange crosses and receivers as green squares in JPEG images or not</span>
<span class="nv">DRAW_WATER_IN_BLUE</span><span class="w">              </span><span class="o">=</span><span class="w"> </span>.true.<span class="w">         </span><span class="c1"># display acoustic layers as constant blue in JPEG images, because they likely correspond to water in the case of ocean acoustics or in the case of offshore oil industry experiments (if off, display them as greyscale, as for elastic or poroelastic elements, for instance for acoustic-only oil industry models of solid media)</span>
<span class="nv">USE_SNAPSHOT_NUMBER_IN_FILENAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># use snapshot number in the file name of JPEG color snapshots instead of the time step (for instance to create movies in an easier way later)</span>

<span class="c1">#### for PostScript snapshots ####</span>
<span class="nv">output_postscript_snapshot</span><span class="w">      </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">         </span><span class="c1"># output Postscript snapshot of the results every NTSTEP_BETWEEN_OUTPUT_IMAGES time steps or not</span>
<span class="nv">imagetype_postscript</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w">              </span><span class="c1"># display 1=displ vector 2=veloc vector 3=accel vector; small arrows are displayed for the vectors</span>
<span class="nv">meshvect</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span>.true.<span class="w">         </span><span class="c1"># display mesh on PostScript plots or not</span>
<span class="nv">modelvect</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># display velocity model on PostScript plots or not</span>
<span class="nv">boundvect</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span>.true.<span class="w">         </span><span class="c1"># display boundary conditions on PostScript plots or not</span>
<span class="nv">interpol</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span>.true.<span class="w">         </span><span class="c1"># interpolation of the PostScript display on a regular grid inside each spectral element, or use the non-evenly spaced GLL points</span>
<span class="nv">pointsdisp</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="w">              </span><span class="c1"># number of points in each direction for interpolation of PostScript snapshots (set to 1 for lower-left corner only)</span>
<span class="nv">subsamp_postscript</span><span class="w">              </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w">              </span><span class="c1"># subsampling of background velocity model in PostScript snapshots</span>
<span class="nv">sizemax_arrows</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>.d0<span class="w">           </span><span class="c1"># maximum size of arrows on PostScript plots in centimeters</span>
<span class="nv">US_LETTER</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># use US letter or European A4 paper for PostScript plots</span>

<span class="c1">#### for wavefield dumps ####</span>
<span class="nv">output_wavefield_dumps</span><span class="w">          </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># output wave field to a text file (creates very big files)</span>
<span class="nv">imagetype_wavefield_dumps</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w">              </span><span class="c1"># display 1=displ vector 2=veloc vector 3=accel vector 4=pressure</span>
<span class="nv">use_binary_for_wavefield_dumps</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>.false.<span class="w">        </span><span class="c1"># use ASCII or single-precision binary format for the wave field dumps</span>

<span class="c1">#-----------------------------------------------------------</span>

<span class="c1"># Ability to run several calculations (several earthquakes)</span>
<span class="c1"># in an embarrassingly-parallel fashion from within the same run;</span>
<span class="c1"># this can be useful when using a very large supercomputer to compute</span>
<span class="c1"># many earthquakes in a catalog, in which case it can be better from</span>
<span class="c1"># a batch job submission point of view to start fewer and much larger jobs,</span>
<span class="c1"># each of them computing several earthquakes in parallel.</span>
<span class="c1"># To turn that option on, set parameter NUMBER_OF_SIMULTANEOUS_RUNS to a value greater than 1.</span>
<span class="c1"># To implement that, we create NUMBER_OF_SIMULTANEOUS_RUNS MPI sub-communicators,</span>
<span class="c1"># each of them being labeled &quot;my_local_mpi_comm_world&quot;, and we use them</span>
<span class="c1"># in all the routines in &quot;src/shared/parallel.f90&quot;, except in MPI_ABORT() because in that case</span>
<span class="c1"># we need to kill the entire run.</span>
<span class="c1"># When that option is on, of course the number of processor cores used to start</span>
<span class="c1"># the code in the batch system must be a multiple of NUMBER_OF_SIMULTANEOUS_RUNS,</span>
<span class="c1"># all the individual runs must use the same number of processor cores,</span>
<span class="c1"># which as usual is NPROC in the Par_file,</span>
<span class="c1"># and thus the total number of processor cores to request from the batch system</span>
<span class="c1"># should be NUMBER_OF_SIMULTANEOUS_RUNS * NPROC.</span>
<span class="c1"># All the runs to perform must be placed in directories called run0001, run0002, run0003 and so on</span>
<span class="c1"># (with exactly four digits).</span>
<span class="c1">#</span>
<span class="c1"># Imagine you have 10 independent calculations to do, each of them on 100 cores; you have three options:</span>
<span class="c1">#</span>
<span class="c1"># 1/ submit 10 jobs to the batch system</span>
<span class="c1">#</span>
<span class="c1"># 2/ submit a single job on 1000 cores to the batch, and in that script create a sub-array of jobs to start 10 jobs,</span>
<span class="c1"># each running on 100 cores (see e.g. http://www.schedmd.com/slurmdocs/job_array.html )</span>
<span class="c1">#</span>
<span class="c1"># 3/ submit a single job on 1000 cores to the batch, start SPECFEM2D on 1000 cores, create 10 sub-communicators,</span>
<span class="c1"># cd into one of 10 subdirectories (called e.g. run0001, run0002,... run0010) depending on the sub-communicator</span>
<span class="c1"># your MPI rank belongs to, and run normally on 100 cores using that sub-communicator.</span>
<span class="c1">#</span>
<span class="c1"># The option below implements 3/.</span>
<span class="c1">#</span>
<span class="nv">NUMBER_OF_SIMULTANEOUS_RUNS</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>

<span class="c1"># if we perform simultaneous runs in parallel, if only the source and receivers vary between these runs</span>
<span class="c1"># but not the mesh nor the model (velocity and density) then we can also read the mesh and model files</span>
<span class="c1"># from a single run in the beginning and broadcast them to all the others; for a large number of simultaneous</span>
<span class="c1"># runs for instance when solving inverse problems iteratively this can DRASTICALLY reduce I/Os to disk in the solver</span>
<span class="c1"># (by a factor equal to NUMBER_OF_SIMULTANEOUS_RUNS), and reducing I/Os is crucial in the case of huge runs.</span>
<span class="c1"># Thus, always set this option to .true. if the mesh and the model are the same for all simultaneous runs.</span>
<span class="c1"># In that case there is no need to duplicate the mesh and model file database (the content of the DATABASES_MPI</span>
<span class="c1"># directories) in each of the run0001, run0002,... directories, it is sufficient to have one in run0001</span>
<span class="c1"># and the code will broadcast it to the others)</span>
<span class="nv">BROADCAST_SAME_MESH_AND_MODEL</span><span class="w">   </span><span class="o">=</span><span class="w"> </span>.true.

<span class="c1">#-----------------------------------------------------------</span>

<span class="c1"># set to true to use GPUs</span>
<span class="nv">GPU_MODE</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span>.true.
</pre></div>
</div>
</div>
<p>At this point, it is worthwhile to note few key parameters within the <code class="docutils literal notranslate"><span class="pre">PAR_FILE</span></code> as it pertains to the <code class="docutils literal notranslate"><span class="pre">Kokkos</span></code>
version of the solver.</p>
<ul class="simple">
<li><p>This version of SPECFEM2D Kokkos does not support simulations running across multiple nodes, i.e., we have not enabled
MPI. Relevant parameter value:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">NPROC</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<ul class="simple">
<li><p>This version of the software can only simulate meshes generated by the internal mesher included in meshfem2d. Relevant
parameter values:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">MODEL</span><span class="w">                           </span><span class="o">=</span><span class="w"> </span>default

<span class="nv">SAVE_MODEL</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span>default
</pre></div>
</div>
<ul class="simple">
<li><p>While defining the velocity models for different materials we need to make sure that all materials describe elastic
materials. Other material systems are not implemented in this version of the package.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">PAR_FILE</span></code> shown above contains many values which define the runtime behaviour of <a class="reference external" href="https://specfem2d.readthedocs.io/en/latest/04_running_the_solver/">xmeshfem2D</a> . These values will be omitted by the
<code class="docutils literal notranslate"><span class="pre">Kokkos</span></code> solver. We define some of these values below in <code class="docutils literal notranslate"><span class="pre">specfem_config.yaml</span></code></p>
</div>
<ul class="simple">
<li><p>The path to the topography file is provided using the <code class="docutils literal notranslate"><span class="pre">interfacesfile</span></code> parameter. Relevant values:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">interfacesfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>topography_file.dat
</pre></div>
</div>
</section>
<section id="topography-file">
<h3>Topography file<a class="headerlink" href="#topography-file" title="Link to this heading"></a></h3>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">topography_file.dat</span><a class="headerlink" href="#id2" title="Link to this code"></a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">#</span>
<span class="linenos"> 2</span><span class="c1"># number of interfaces</span>
<span class="linenos"> 3</span><span class="c1">#</span>
<span class="linenos"> 4</span><span class="w"> </span><span class="m">2</span>
<span class="linenos"> 5</span><span class="c1">#</span>
<span class="linenos"> 6</span><span class="c1"># for each interface below, we give the number of points and then x,z for each point</span>
<span class="linenos"> 7</span><span class="c1">#</span>
<span class="linenos"> 8</span><span class="c1">#</span>
<span class="linenos"> 9</span><span class="c1"># interface number 1 (bottom of the mesh)</span>
<span class="linenos">10</span><span class="c1">#</span>
<span class="linenos">11</span><span class="w"> </span><span class="m">2</span>
<span class="linenos">12</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>
<span class="linenos">13</span><span class="w"> </span><span class="m">5000</span><span class="w"> </span><span class="m">0</span>
<span class="linenos">14</span><span class="c1"># interface number 2 (topography, top of the mesh)</span>
<span class="linenos">15</span><span class="c1">#</span>
<span class="linenos">16</span><span class="w"> </span><span class="m">2</span>
<span class="linenos">17</span><span class="w">    </span><span class="m">0</span><span class="w"> </span><span class="m">3000</span>
<span class="linenos">18</span><span class="w"> </span><span class="m">5000</span><span class="w"> </span><span class="m">3000</span>
<span class="linenos">19</span><span class="c1">#</span>
<span class="linenos">20</span><span class="c1"># for each layer, we give the number of spectral elements in the vertical direction</span>
<span class="linenos">21</span><span class="c1">#</span>
<span class="linenos">22</span><span class="c1">#</span>
<span class="linenos">23</span><span class="c1"># layer number 1 (bottom layer)</span>
<span class="linenos">24</span><span class="c1">#</span>
<span class="linenos">25</span><span class="w"> </span><span class="m">60</span>
</pre></div>
</div>
</div>
</section>
<section id="running-xmeshfem2d">
<h3>Running <code class="docutils literal notranslate"><span class="pre">xmeshfem2D</span></code><a class="headerlink" href="#running-xmeshfem2d" title="Link to this heading"></a></h3>
<p>Copy the parameters file and topography file to the <code class="docutils literal notranslate"><span class="pre">DATA</span></code> folder within <code class="docutils literal notranslate"><span class="pre">SPECFEM2D</span></code> root directory. To execute the
mesher from the root of <code class="docutils literal notranslate"><span class="pre">specfem2d</span></code> run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./bin/xmeshfem2D
</pre></div>
</div>
<p>Note the path of the database file and <a class="reference internal" href="../user_documentation/seismogram.html#stations-file"><span class="std std-ref">STATIONS file</span></a> generated after successfully running the mesher. Generally, the database will be located within <code class="docutils literal notranslate"><span class="pre">OUTPUT_FILES</span></code> directory within root of SPECFEM2D and the <a class="reference internal" href="../user_documentation/seismogram.html#stations-file"><span class="std std-ref">STATIONS file</span></a> should be located in <code class="docutils literal notranslate"><span class="pre">DATA</span></code> folder of SPECFEM2D root.</p>
</section>
</section>
<section id="defining-sources">
<h2>Defining sources<a class="headerlink" href="#defining-sources" title="Link to this heading"></a></h2>
<p>Next we define the sources using a YAML file. For full description on parameters used to define sources refer <a class="reference internal" href="../source_description/index.html#source-description"><span class="std std-ref">Source Description</span></a>. Here we define 2 sources file pertaining to a single single source and 2 sources inside the simulation box.</p>
</section>
<section id="configuring-the-solver">
<h2>Configuring the solver<a class="headerlink" href="#configuring-the-solver" title="Link to this heading"></a></h2>
<p>Now that we have generated a mesh and defined the sources, we need to set up the solver. To do this we define another YAML file <code class="docutils literal notranslate"><span class="pre">specfem_config.yaml</span></code>. For full description on parameters used to define sources refer <a class="reference internal" href="../parameter_documentation/index.html#parameter-documentation"><span class="std std-ref">Parameter documentation</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">specfem_config.yaml</span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">parameters</span><span class="p">:</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="nt">header</span><span class="p">:</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="c1">## Header information is used for logging. It is good practice to give your simulations explicit names</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Isotropic Elastic simulation</span><span class="w"> </span><span class="c1"># name for your simulation</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="c1"># A detailed description for your simulation</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="linenos"> 8</span><span class="w">      </span><span class="no">Material systems : Elastic domain (1)</span>
<span class="linenos"> 9</span><span class="w">      </span><span class="no">Interfaces : None</span>
<span class="linenos">10</span><span class="w">      </span><span class="no">Sources : Force source (1)</span>
<span class="linenos">11</span><span class="w">      </span><span class="no">Boundary conditions : Neumann BCs on all edges</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="w">  </span><span class="nt">simulation-setup</span><span class="p">:</span>
<span class="linenos">14</span><span class="w">    </span><span class="c1">## quadrature setup</span>
<span class="linenos">15</span><span class="w">    </span><span class="nt">quadrature</span><span class="p">:</span>
<span class="linenos">16</span><span class="w">      </span><span class="nt">alpha</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="linenos">17</span><span class="w">      </span><span class="nt">beta</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="linenos">18</span><span class="w">      </span><span class="nt">ngllx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="linenos">19</span><span class="w">      </span><span class="nt">ngllz</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="w">    </span><span class="c1">## Solver setup</span>
<span class="linenos">22</span><span class="w">    </span><span class="nt">solver</span><span class="p">:</span>
<span class="linenos">23</span><span class="w">      </span><span class="nt">time-marching</span><span class="p">:</span>
<span class="linenos">24</span><span class="w">        </span><span class="nt">type-of-simulation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">forward</span>
<span class="linenos">25</span><span class="w">        </span><span class="nt">time-scheme</span><span class="p">:</span>
<span class="linenos">26</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Newmark</span>
<span class="linenos">27</span><span class="w">          </span><span class="nt">dt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.1e-5</span>
<span class="linenos">28</span><span class="w">          </span><span class="nt">nstep</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="w">  </span><span class="nt">seismogram</span><span class="p">:</span>
<span class="linenos">31</span><span class="w">    </span><span class="nt">stations-file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;PATH TO STATIONS FILE&gt;</span>
<span class="linenos">32</span><span class="w">    </span><span class="nt">angle</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="linenos">33</span><span class="w">    </span><span class="nt">seismogram-type</span><span class="p">:</span>
<span class="linenos">34</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">velocity</span>
<span class="linenos">35</span><span class="w">    </span><span class="nt">nstep_between_samples</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">36</span><span class="w">    </span><span class="nt">seismogram-format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ascii</span>
<span class="linenos">37</span><span class="w">    </span><span class="nt">output-folder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;PATH TO DIRECTORY FOR STORING OUTPUTS&gt;</span>
<span class="linenos">38</span>
<span class="linenos">39</span><span class="w">  </span><span class="c1">## Runtime setup</span>
<span class="linenos">40</span><span class="w">  </span><span class="nt">run-setup</span><span class="p">:</span>
<span class="linenos">41</span><span class="w">    </span><span class="nt">number-of-processors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">42</span><span class="w">    </span><span class="nt">number-of-runs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">43</span>
<span class="linenos">44</span><span class="w">  </span><span class="c1">## databases</span>
<span class="linenos">45</span><span class="w">  </span><span class="nt">databases</span><span class="p">:</span>
<span class="linenos">46</span><span class="w">    </span><span class="nt">mesh-database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;PATH TO MESHFEM DATABASE FILE&gt;</span>
<span class="linenos">47</span><span class="w">    </span><span class="nt">source-file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;PATH TO SOURCES YAML FILE&gt;</span>
</pre></div>
</div>
</div>
<p>At this point lets focus on a few sections in this file:</p>
<ul class="simple">
<li><p>Define the path to the meshfem generated database file using the <code class="docutils literal notranslate"><span class="pre">mesh-database</span></code> parameter and the path to source description file using <code class="docutils literal notranslate"><span class="pre">source-file</span></code> parameter. Relevant parameter values:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1">## databases</span>
<span class="nt">databases</span><span class="p">:</span>
<span class="w">  </span><span class="nt">mesh-database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;PATH TO MESHFEM DATABASE FILE&gt;</span>
<span class="w">  </span><span class="nt">source-file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;PATH TO SOURCES YAML FILE&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Define the path to <a class="reference internal" href="../user_documentation/seismogram.html#stations-file"><span class="std std-ref">STATIONS file</span></a> and a directory to store output. If an output directory is not specified the seismogram outputs will be stored in the current working directory. Relevant parameter values:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">seismogram</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stations-file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;PATH TO STATIONS FILE&gt;</span>
<span class="w">  </span><span class="nt">output-folder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;PATH TO DIRECTORY FOR STORING OUTPUTS&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>It is good practice to have distinct header section for you simulation. These sections will be printed to standard output during runtime helping the you to distinguish between runs using standard strings. Relevant paramter values</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">header</span><span class="p">:</span>
<span class="w">  </span><span class="c1">## Header information is used for logging. It is good practice to give your simulations explicit names</span>
<span class="w">  </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Isotropic Elastic simulation</span><span class="w"> </span><span class="c1"># name for your simulation</span>
<span class="w">  </span><span class="c1"># A detailed description for your simulation</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">Material systems : Elastic domain (1)</span>
<span class="w">    </span><span class="no">Interfaces : None</span>
<span class="w">    </span><span class="no">Sources : Force source (1)</span>
<span class="w">    </span><span class="no">Boundary conditions : Neumann BCs on all edges</span>
</pre></div>
</div>
</section>
<section id="running-the-solver">
<h2>Running the solver<a class="headerlink" href="#running-the-solver" title="Link to this heading"></a></h2>
<p>Finally, to run the SPECFEM2D kokkos solver</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./specfem2d<span class="w"> </span>-p<span class="w"> </span>&lt;PATH<span class="w"> </span>TO<span class="w"> </span>specfem_config.yaml&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure either your are in the build directory of SPECFEM2D kokkos or the build directory is added to your <code class="docutils literal notranslate"><span class="pre">PATH</span></code>.</p>
</div>
</section>
<section id="visualizing-seimograms">
<h2>Visualizing seimograms<a class="headerlink" href="#visualizing-seimograms" title="Link to this heading"></a></h2>
<p>On successful completion of the simulation the seismograms are stored within the output folder. Which can be visualized using standard plotting tools.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As we move forward, we plan to add modules for visualizing seismograms and integrating with common siesmic postprocessing tools like obspy.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Cookbooks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../developer_documentation/index.html" class="btn btn-neutral float-right" title="Developer documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Rohit Kakodkar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>